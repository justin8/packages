diff --git a/69-bcache.rules b/69-bcache.rules
index 5d28e70..9cc7f0d 100644
--- a/69-bcache.rules
+++ b/69-bcache.rules
@@ -18,6 +18,7 @@ ENV{ID_FS_TYPE}!="bcache", GOTO="bcache_backing_end"
 ENV{ID_FS_UUID_ENC}=="?*", SYMLINK+="disk/by-uuid/$env{ID_FS_UUID_ENC}"
 
 LABEL="bcache_backing_found"
+RUN{builtin}+="kmod load bcache"
 RUN+="bcache-register $tempnode"
 LABEL="bcache_backing_end"
 
diff --git a/Makefile b/Makefile
index 3f8d87b..c824ae3 100644
--- a/Makefile
+++ b/Makefile
@@ -5,7 +5,7 @@ DRACUTLIBDIR=/lib/dracut
 INSTALL=install
 CFLAGS+=-O2 -Wall -g
 
-all: make-bcache probe-bcache bcache-super-show
+all: make-bcache probe-bcache bcache-super-show bcache-register
 
 install: make-bcache probe-bcache bcache-super-show
 	$(INSTALL) -m0755 make-bcache bcache-super-show	$(DESTDIR)${PREFIX}/sbin/
@@ -29,3 +29,4 @@ probe-bcache: CFLAGS += `pkg-config --cflags uuid blkid`
 bcache-super-show: LDLIBS += `pkg-config --libs uuid`
 bcache-super-show: CFLAGS += -std=gnu99
 bcache-super-show: bcache.o
+bcache-register: bcache-register.o
diff --git a/bcache-register b/bcache-register
deleted file mode 100755
index 9b592bc..0000000
--- a/bcache-register
+++ /dev/null
@@ -1,4 +0,0 @@
-#!/bin/sh
-/sbin/modprobe -qba bcache
-test -f /sys/fs/bcache/register_quiet && echo "$1" > /sys/fs/bcache/register_quiet
-
diff --git a/bcache-register.c b/bcache-register.c
new file mode 100644
index 0000000..fc9fec6
--- /dev/null
+++ b/bcache-register.c
@@ -0,0 +1,26 @@
+/*
+ * Author: Simon Gomizelj <simongmzlj@gmail.com>
+ *
+ * GPLv2
+ */
+
+#include <stdio.h>
+#include <unistd.h>
+#include <fcntl.h>
+
+int main(int argc, char *argv[])
+{
+    int fd, i, rc = 0;
+
+    fd = open("/sys/fs/bcache/register_quiet", O_WRONLY);
+    if (fd < 0)
+        return 1;
+
+    for (i = 1; i < argc; ++i)
+        rc |= (dprintf(fd, "%s\n", argv[i]) < 0) ? 1 : 0;
+
+    close(fd);
+    return rc;
+}
+
+// vim: et:sts=4:sw=4:cino=(0
